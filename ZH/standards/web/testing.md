# Web 测试标准

## 测试理念

- 尽早测试，经常测试
- 尽可能自动化测试
- 在适当的级别（单元、集成、端到端）进行测试
- 编写可维护且可靠的测试
- 同时测试快乐路径和边缘情况
- 使用测试来防止回归
- 根据业务影响确定测试优先级
- 像对待生产代码一样认真对待测试代码

## 测试类型和覆盖率

### 单元测试

- **目标**：各个函数、组件和模块
- **覆盖率目标**：80% 以上的业务逻辑和实用程序
- **工具**：Jest、Vitest、React 测试库
- **最佳实践**：
- 遵循 AAA 模式（Arrange、Act、Assert）
- 尽可能每个测试使用一个断言
- 模拟外部依赖关系
- 测试边缘情况和错误条件
- 保持测试快速（每次测试时间小于 100 毫秒）测试)
- 使用描述性测试名称
- 测试彼此隔离

### 集成测试

- **目标**：组件和服务之间的交互
- **覆盖率目标**：关键用户流程和组件交互
- **工具**：React 测试库、MSW、Supertest
- **最佳实践**：
- 测试组件组合
- 测试表单提交
- 模拟 API 响应
- 测试状态变化
- 验证 DOM 更新
- 测试路由和导航
- 使用真实的测试数据

### 端到端测试

- **目标**：从 UI 到后端的完整用户流程
- **覆盖率目标**：关键业务路径和用户旅程
- **工具**：Cypress、Playwright
- **最佳实践**：
- 关注关键用户旅程
- 在多个浏览器上进行测试
- 使用稳定的选择器(data-testid)
- 设置隔离的测试环境
- 有效管理测试数据
- 故障时截取屏幕截图
- 为不稳定测试实现重试逻辑

### 可视化回归测试

- **目标**：UI 外观和布局
- **覆盖率目标**：关键 UI 组件和页面
- **工具**：Percy、Chromatic、Playwright
- **最佳实践**：
- 捕获基准屏幕截图
- 跨不同视口测试
- 忽略动态内容
- 仔细检查视觉变化
- 测试亮/暗模式
- 使用不同长度的内容进行测试
- 与 CI/CD 流水线集成

### 无障碍测试

- **目标**：WCAG 合规性和无障碍问题
- **覆盖率目标**：所有面向用户的组件和页面
- **工具**：axe、Lighthouse、WAVE
- **最佳实践**：
- 测试键盘导航
- 验证屏幕阅读器兼容性
- 检查颜色对比度
- 测试焦点管理
- 验证 ARIA 属性
- 使用辅助技术进行测试
- 自动执行基本的无障碍访问检查

### 性能测试

- **目标**：页面加载时间、渲染性能
- **覆盖率目标**：关键页面和关键用户路径
- **工具**：Lighthouse、WebPageTest、k6
- **最佳实践**：
- 衡量核心 Web 指标
- 在低端设备上测试
- 模拟网络限流
- 监控包大小
- 使用真实的缓存场景进行测试
- 测量交互时间
- 设定性能预算

## 测试实践

### 测试组织

- 按功能或组件对测试进行逻辑分组
- 使用描述性文件名和测试说明
- 分离测试实用程序和测试夹具
- 按镜像的层次结构组织测试代码库
- 将测试文件与所测试代码保持紧密联系
- 使用一致的命名约定
- 分离单元测试、集成测试和端到端测试

### 测试数据管理

- 使用工厂或构建器存储测试数据
- 避免硬编码测试数据
- 使用与生产模式匹配的真实数据
- 在测试之间重置测试状态
- 隔离测试环境
- 考虑测试数据中的数据隐私
- 对边缘情况使用随机种子数据

### 模拟和存根

- 模拟外部依赖项（API、服务）
- 使用真实的模拟响应
- 在测试之间重置模拟
- 避免过度模拟
- 在适当的级别进行模拟
- 记录模拟行为
- 使用 MSW 进行 API 模拟

### 持续集成

- 在每个拉取请求上运行测试
- 实现并行测试执行
- 设置测试报告和仪表板
- 配置测试失败通知
- 为不稳定的测试实施测试重试
- 缓存测试依赖项
-在适当的阶段运行不同类型的测试

## 测试驱动开发 (TDD)

- 在实现功能之前编写测试
- 遵循“红-绿-重构”循环
- 从简单的测试用例开始
- 逐步增加复杂性
- 使用测试驱动设计
- 随着代码的演进重构测试
- 关注行为，而非实现

## 测试维护

- 定期审查和更新测试
- 移除或修复不稳定的测试
- 根据代码变更重构测试
- 监控测试性能
- 定期分析测试覆盖率
- 记录测试策略
- 培训团队成员进行测试实践

## 专门测试

### API 测试

- 测试所有 API 端点
- 验证请求/响应模式
- 测试身份验证和授权
- 测试错误处理和状态码
- 验证业务逻辑
- 测试速率限制和配额
- 记录 API 测试用例

### 状态管理测试

- 测试状态转换
- 验证初始状态
- 测试 Reducer 和 Action
- 测试选择器和派生状态
- 模拟外部依赖关系
- 测试异步状态变化
- 验证状态持久性

### 表单测试

- 测试表单提交
- 验证表单输入
- 测试错误状态
- 测试表单重置功能
- 测试条件表单逻辑
- 验证表单元素的可访问性
- 测试带键盘导航的表单

### 安全测试

- 测试身份验证流程
- 验证授权检查
- 测试常见漏洞（XSS、CSRF）
- 验证输入清理
- 测试文件上传安全性
- 验证安全标头
- 测试 OWASP Top 10