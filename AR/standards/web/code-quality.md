# معايير جودة الكود

## المبادئ الأساسية

- كتابة كود نظيف، قابل للصيانة، وموثق ذاتيًا
- اتباع مبادئ SOLID وDRY
- الحفاظ على الدوال صغيرة ومُركزة (مسؤولية واحدة)
- استخدام تسمية وصفية للمتغيرات والدوال والفئات
- الحفاظ على نمط كود متسق في جميع أنحاء المشروع
- توثيق المنطق المُعقد وواجهات برمجة التطبيقات العامة
- كتابة كود للبشر، وليس فقط للأجهزة

## معايير JavaScript/TypeScript

### تهيئة TypeScript

- استخدام الوضع الصارم (`"strict": true`)
- تفعيل جميع خيارات فحص النوع المُوصى بها
- تهيئة دقة الوحدة المناسبة
- تعيين إصدار ECMAScript المُستهدف المناسب
- تحديد أنماط التضمين/الاستبعاد
- استخدام أسماء مستعارة للمسارات لعمليات استيراد أنظف

### اصطلاحات التسمية

- **المتغيرات/الدوال**: camelCase (`getUserData`, `calculateTotal`)
- **الفئات/الواجهات/الأنواع**: PascalCase (`UserProfile`، `ApiResponse`)
- **الثوابت**: UPPER_SNAKE_CASE (`MAX_RETRY_COUNT`، `API_URL`)
- **الخصائص الخاصة**: استخدم البادئة `#` أو `_` (`#privateField`، `_privateMethod`)
- **المتغيرات المنطقية**: استخدم البادئات "is"، "has"، "can" (`isActive`، `hasPermission`)
- **ملفات المكونات**: PascalCase مع الامتداد (`UserCard.tsx`)
- **ملفات الأدوات**: camelCase مع الامتداد (`formatDate.ts`)

### تنظيم الكود

- فئة/مكون واحد لكل ملف
- تجميع الواردات حسب الخارجية/الداخلية
- ترتيب الواردات أبجديًا
- استخدام تصديرات البراميل (index.ts) للوظائف ذات الصلة
- تنظيم الكود حسب الميزة/الوحدة
- الحفاظ على الملفات أقل من 400 سطر (وتقسيمها إذا كانت أكبر)
- الحفاظ على الدوال أقل من 50 سطرًا
- الحد الأقصى للتداخل: 3-4 مستويات

### أفضل الممارسات

- تفضيل الثبات (ثابت، للقراءة فقط، Object.freeze)
- استخدام التسلسل الاختياري ودمج العدم
- تطبيق معالجة الأخطاء بشكل صحيح
- تجنب أي نوع إلا عند الضرورة
- استخدام حراس الأنواع للتحقق من النوع وقت التشغيل
- تفضيل عدم التزامن/الانتظار على الوعود الأولية
- تجنب الأرقام السحرية والسلاسل (استخدم الثوابت)
- تطبيق عمليات التحقق الصحيحة من العدم/غير المحدد
- استخدام عمليات الإرجاع المبكرة لتقليل التداخل

## معايير React

### بنية المكونات

- تفضيل المكونات الوظيفية ذات الخطافات
- استخدام الصادرات المُسمّاة للمكونات
- تنفيذ التحقق من صحة الخاصيات باستخدام TypeScript
- استخراج منطق مُعقّد إلى خطافات مُخصّصة
- التركيز على المكونات في واجهة المستخدم
- تطبيق حدود أخطاء مناسبة
- استخدام React.memo لتحسين الأداء
- استخراج مكونات قابلة لإعادة الاستخدام

### إدارة الحالة

- استخدام الحالة المحلية للبيانات الخاصة بالمكون
- استخدام السياق للحالة المُشتركة بين المكونات
- مراعاة إدارة الحالة الخارجية للتطبيقات المُعقّدة
- الحفاظ على الحالة مُوحّدة ومُنخفضة
- تطبيق تهيئة الحالة الصحيحة
- استخدام المُخفّضات لمنطق الحالة المُعقّد
- تجنّب حفر الخاصيات (استخدام التركيب أو السياق)

### تحسين الأداء

- استخدام React.memo للمكونات البحتة
- تطبيق useMemo للحسابات المُكلفة
- استخدام useCallback لحفظ الدوال
- إنشاء قوائم طويلة افتراضيًا (react-window، react-virtualized)
- تطبيق مصفوفات تبعيات مناسبة في الخطافات
- تجنّب غير الضروري إعادة التصيير
- استخدام React Profiler لتحديد الاختناقات

## معايير الاختبار

### اختبار الوحدات

- اختبار جميع منطق العمل والأدوات المساعدة
- استخدام Jest أو Vitest كمشغل للاختبار
- تطبيق محاكاة دقيقة للتبعيات
- استخدام مكتبة الاختبار لاختبار المكونات
- اتباع نمط AAA (الترتيب، التنفيذ، التأكيد)
- كتابة أسماء اختبار وصفية
- السعي لتغطية أكواد برمجية بنسبة تزيد عن 80%
- اختبار الحالات الحدية وسيناريوهات الأخطاء

### اختبار التكامل

- اختبار تفاعلات المكونات
- اختبار عمليات إرسال النماذج وتدفقات المستخدم
- استخدام MSW لمحاكاة واجهة برمجة التطبيقات
- اختبار التوجيه والتنقل
- التحقق من تغييرات الحالة
- الاختبار باستخدام بيانات واقعية

### الاختبار الشامل

- استخدام Cypress أو Playwright
- اختبار مسارات المستخدم المهمة
- الاختبار على متصفحات متعددة
- تطبيق عزل اختباري دقيق
- استخدم سمات البيانات لمحددات الاختبار
- طبّق منطق إعادة المحاولة للاختبارات غير المستقرة
- سهولة الوصول للاختبار

## معايير مراجعة الكود

### العملية

- يجب مراجعة جميع الكود قبل الدمج
- يجب اجتياز عمليات التحقق الآلية قبل المراجعة
- استخدم قوالب طلبات السحب
- اجعل طلبات السحب صغيرة ومركّزة
- استجب لتعليقات المراجعة فورًا
- حلّ جميع التعليقات قبل الدمج
- اسحق عمليات الالتزام قبل الدمج

### قائمة مراجعة

- يتوافق الكود مع معايير المشروع
- تم تضمين الاختبارات واجتيازها
- تم تحديث الوثائق
- لم يتم العثور على ثغرات أمنية
- تم مراعاة آثار الأداء
- تم استيفاء متطلبات إمكانية الوصول
- تم التعامل مع الحالات الجانبية
- لا يوجد كود أو تبعيات غير ضرورية

## الأدوات

### التدقيق والتنسيق

- ESLint مع القواعد المناسبة
- Prettier لتنسيق متسق
- Husky لخطافات ما قبل الالتزام
- مرحلة التحسين التدريجي
- مُجمِّع TypeScript لفحص النوع
- Stylelint لـ CSS/SCSS

### التحليل الثابت

- SonarQube أو CodeClimate
- مراقبة مقاييس التعقيد
- الكشف عن الأكواد المكررة
- فحص الثغرات الأمنية
- تحليل حجم الحزمة
- الكشف عن الأكواد غير المستخدمة

### تكامل CI/CD

- تشغيل جميع عمليات التحقق على كل طلب سحب
- حظر الدمج في حال فشل عمليات التحقق
- إنشاء ونشر تقارير تغطية الاختبار
- تنفيذ اختبار انحدار الأداء
- أتمتة تحديثات التبعيات
- نشر بيئات المعاينة