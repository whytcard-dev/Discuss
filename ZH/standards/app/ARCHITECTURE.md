# WhytCard 的全局架构

## 简介

本文档介绍了 WhytCard 项目的全局架构，这是一个开源的网页抓取和 AI 训练平台。该架构设计为模块化、可扩展且易于维护，可在确保系统稳定性的同时轻松添加新功能。

## 概述

WhytCard 采用客户端-服务器架构，前端和后端清晰分离。这种分离允许两个组件独立发展，并促进团队合作。

```
┌────────────────┐ ┌────────────────┐
│ │ │ │ 
│ 前端 │◄────►│ 后端 │ 
│ (Vue.js) │ │ (FastAPI) │ 
│ │ │ │ 
└────────────────┘ └──────────────────┘
▲
│ 
▼
┌────────────────┐
│ │ 
│ 数据抓取 & │ 
│ 数据管道 │ 
│ │ 
└────────────────┘
▲
│ 
▼
┌──────────────────┐
│ │ 
│ 存储│
│ │
└──────────────────┘
```

## 主要组件

### 1. 前端 (Vue.js)

前端使用 Vue.js 开发，并使用 Tailwind CSS 进行样式设置。它负责用户界面和用户体验。

#### 主要特性

- **框架**：Vue.js 3 和 Composition API
- **样式**：Tailwind CSS
- **动画**：Framer Motion
- **国际化**：i18next，支持自动浏览器语言检测
- **路由**：Vue Router
- **状态管理**：Pinia

#### 结构

```
src/
── components/ # 可复用组件
── config/ # 前端配置
── i18n/ # 翻译文件
── router/ # 路由配置
── views/ # 主页
└── main.js # 入口点
```

### 2. 后端 (FastAPI)

后端使用 FastAPI 开发，这是一个用于创建 API 的现代高性能 Python 框架。它负责处理所有服务器操作、数据访问和业务逻辑。

#### 主要功能

- **框架**: FastAPI
- **身份验证**: JWT
- **验证**: Pydantic
- **API 文档**: 集成 Swagger UI

#### 结构

```
backend/
│ config/ # 后端配置
│ │ └── core/ # 主要业务逻辑
│ │ └── schemas/ # Pydantic schemas
│ └── models/ # 数据模型
│ └── utils/ # 实用程序
└── main.py # 入口点
```

### 3. 数据抓取和数据管道

此模块负责从网络来源收集数据并将其转换为 AI 模型训练所需的数据。

#### 主要功能

- **Scraping**：基于 aiohttp 和 BeautifulSoup 的异步数据抓取系统
- **Orchestration**：任务和优先级管理
- **Transformation**：数据清理和规范化
- **Cache**：缓存系统，避免冗余请求

#### 结构

```
backend/
│ ... #### 存储选项

- **数据库**：PostgreSQL 用于结构化数据
- **文件存储**：本地文件系统或兼容 S3 的文件系统用于大数据
- **缓存**：Redis 用于分布式缓存

## 数据流

### 1. 数据收集

```
┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│ │ │ │ │ 
│ Web │────►│ 爬虫 │────►│ 缓存 │ 
│ 来源 │ │ │ │ 
└──────────────┘ └──────────────┘ └──────────────┘
│
▼
┌──────────────┐ ┌──────────────┐
│ │ │ │
│ 处理器 │────►│ 存储 │
│ │ │ │
└──────────────┘ └──────────────┘
```

1. 爬虫从网络源收集数据
2. 数据被缓存以避免重复请求
3. 处理器清理并转换数据
4. 转换后的数据存储以供后续使用

### 2. 模型训练

```
┌────────────┐ ┌────────────┐ ┌────────────┐
│ │ │ │ │ │
│ 数据集 │────►│ 预处理器│────►│ 训练 │
│ │ │ │ │ │
└──────────────┘ └──────────────┘ └──────────────┘
│
▼
┌──────────────┐
│ │
│ 模型 │
│ │
└──────────────┘
```

1. 从存储中提取数据集
2. 对数据进行训练预处理
3. 使用预处理后的数据训练模型
4. 保存训练好的模型

### 3. 模型使用

```
┌────────────┐ ┌──────────────┐ ┌──────────────┐
│ │ │ │ │ 
│ API │────►│ 模型 │────►│响应 │ 
│ 请求 │ │ │ │ 
└────────────┘ └────────────┘ └────────────┘ 
```

1. 收到 API 请求
2. 使用合适的模型处理请求
3. 生成并返回响应

## 组件间通信

### REST API

前端和后端之间的通信主要通过 REST API 进行。端点通过 Swagger UI 进行逻辑组织和记录。

### WebSockets

对于需要实时更新的功能（例如跟踪抓取任务），WebSockets 用于实现双向通信。

### 消息队列

对于异步和长时间运行的任务，消息队列（例如 RabbitMQ 或 Redis Pub/Sub）用于解耦组件并确保可靠性。

## 部署

### 部署选项

WhytCard 可以通过多种方式部署：

1. **桌面应用程序**：使用 Tauri 创建跨平台桌面应用程序
2. **云部署**：部署在 AWS、GCP 或 Azure 等云服务上
3. **自托管**：安装在个人或公司服务器上

### 部署架构

``` 
┌────────────────┐ ┌────────────────┐ 
│ │ │ │ 
│ 前端 │◄────►│ API 网关 │ 
│ （静态） │ │ │ 
└────────────────┘ └──────────────────┘ 
▲ 
│ 
▼ 
┌──────────────────┐
│ │
│ 后端 API │ 
│ │
└────────────────┘
▲
│ 
▼
┌────────────────┐ ┌────────────────┐
│ │ │ │
│ 数据库 │ │ 文件存储 │ 
│ │ │ │ 
└────────────────┘ └────────────────┘
```

## 安全性

### 安全原则

1. **纵深防御**：多层安全保护
2. **最小权限原则**：最小化必要访问权限
3. **输入验证**：所有用户输入均经过验证
4. **数据保护：敏感数据加密

### 安全措施

- **身份验证**：JWT 令牌轮换
- **授权**：基于角色的访问控制
- **防御常见攻击**：XSS、CSRF、SQL 注入
- **审计**：重要操作日志

## 可扩展性

该架构设计为水平和垂直可扩展：

- **微服务**：组件可独立部署
- **缓存**：使用多级缓存
- **负载均衡**：在多个实例之间分配流量
- **分区**：数据分离以提高性能

## 监控和可观察性

- **日志记录**：使用 ELK Stack 或同等工具进行集中式日志记录
- **指标**：使用 Prometheus 收集指标
- **追踪**：使用 OpenTelemetry 进行请求追踪
- **警报**：基于预定义指标的警报阈值

## 结论

WhytCard 的架构设计稳健、可扩展且易于维护。不同组件之间职责的清晰划分，使其能够独立发展，并促进团队合作。技术选择充分考虑了当前和未来的项目需求以及行业最佳实践。

该架构将定期审查和更新，以适应新的需求和技术发展。

---

最后更新时间：2025-01-15